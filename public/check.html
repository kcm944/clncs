<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</title>
    <style>
        :root {
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --primary-color: #007bff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .status {
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status.success {
            background-color: #d1e7dd;
            color: #155724;
            border-left: 4px solid var(--success-color);
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--error-color);
        }

        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning-color);
        }

        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--info-color);
        }

        .status-icon {
            font-size: 20px;
        }

        .details {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }

        .details.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toggle-details {
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
            margin-top: 8px;
            display: inline-block;
        }

        .toggle-details:hover {
            color: #0056b3;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: block;
            margin: 30px auto 0;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .progress-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }

        .summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            display: none;
        }

        .summary.show {
            display: block;
        }

        .summary h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .test-section {
                padding: 15px;
            }

            .test-section h2 {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„</h1>

        <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù… -->
        <div class="test-section">
            <h2>âš™ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
            <div id="healthStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…...</span>
            </div>
            <div class="details" id="healthDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="test-section">
            <h2>ğŸ—ƒï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <div id="dbStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
            </div>
            <div class="details" id="dbDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ -->
        <div class="test-section">
            <h2>ğŸ“‹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h2>
            <div id="tablesStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„...</span>
            </div>
            <div class="details" id="tablesDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª -->
        <div class="test-section">
            <h2>ğŸ¥ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h2>
            <div id="clinicsStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª...</span>
            </div>
            <div class="details" id="clinicsDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®ØµØµØ§Øª -->
        <div class="test-section">
            <h2>ğŸ©º Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h2>
            <div id="specialtiesStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ®ØµØµØ§Øª...</span>
            </div>
            <div class="details" id="specialtiesDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
        <div class="test-section">
            <h2>ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
            <div id="feedbacksStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...</span>
            </div>
            <div class="details" id="feedbacksDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div class="test-section">
            <h2>ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            <div id="usersStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</span>
            </div>
            <div class="details" id="usersDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
        <div class="test-section">
            <h2>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
            <div id="notificationsStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...</span>
            </div>
            <div class="details" id="notificationsDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
        <div class="test-section">
            <h2>ğŸ“° Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2>
            <div id="newsStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</span>
            </div>
            <div class="details" id="newsDetails"></div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div class="test-section">
            <h2>ğŸ”„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h2>
            <div id="syncStatus" class="status info">
                <span class="loading"></span>
                <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</span>
            </div>
            <div class="details" id="syncDetails"></div>
        </div>

        <button onclick="runAllTests()">âš¡ Ø¥Ø¬Ø±Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>

        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="summary" id="summary">
            <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress() {
            const progress = (testResults.passed + testResults.failed + testResults.warnings) / testResults.total * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
        function updateStatus(elementId, message, status, icon = '', details = '') {
            const element = document.getElementById(elementId);
            const detailsElement = document.getElementById(`${elementId}Details`);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
            element.innerHTML = `
                ${icon ? `<span class="status-icon">${icon}</span>` : ''}
                <span>${message}</span>
                ${details ? `<span class="toggle-details" onclick="toggleDetails('${elementId}')">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>` : ''}
            `;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø©
            element.className = `status ${status}`;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ§ØµÙŠÙ„
            if (details) {
                detailsElement.innerHTML = `<pre>${details}</pre>`;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
            updateSummary();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        function toggleDetails(elementId) {
            const detailsElement = document.getElementById(`${elementId}Details`);
            detailsElement.classList.toggle('show');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
        function updateSummary() {
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = `
                <div class="summary-item">
                    <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:</span>
                    <span>${testResults.total}</span>
                </div>
                <div class="summary-item">
                    <span>Ù†Ø§Ø¬Ø­Ø©:</span>
                    <span style="color: var(--success-color);">${testResults.passed}</span>
                </div>
                <div class="summary-item">
                    <span>ÙØ§Ø´Ù„Ø©:</span>
                    <span style="color: var(--error-color);">${testResults.failed}</span>
                </div>
                <div class="summary-item">
                    <span>ØªØ­Ø°ÙŠØ±Ø§Øª:</span>
                    <span style="color: var(--warning-color);">${testResults.warnings}</span>
                </div>
                <div class="summary-item">
                    <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                    <span>${testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0}%</span>
                </div>
            `;

            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù†ØªØ§Ø¦Ø¬
            if (testResults.total > 0) {
                document.getElementById('summary').classList.add('show');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
        async function testHealth() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();

                if (data.status === 'ok') {
                    testResults.passed++;
                    updateStatus(
                        'healthStatus',
                        'Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯',
                        'success',
                        'âœ…',
                        `Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯\nØ§Ù„ÙˆÙ‚Øª: ${new Date(data.timestamp).toLocaleString()}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'healthStatus',
                        `Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${data.status}`,
                        'error',
                        'âŒ',
                        `Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${data.status}\nØ§Ù„ÙˆÙ‚Øª: ${new Date(data.timestamp).toLocaleString()}`
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'healthStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function testDatabase() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/test-connection`);
                const data = await response.json();

                if (data.databaseConnected) {
                    testResults.passed++;
                    updateStatus(
                        'dbStatus',
                        `Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØµÙ„Ø©: ${data.clinicsCount} Ø¹ÙŠØ§Ø¯Ø© Ù…Ø³Ø¬Ù„Ø©`,
                        'success',
                        'âœ…',
                        `Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${data.database}\nØ¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ${data.clinicsCount}\nØ§Ù„ÙˆÙ‚Øª: ${new Date(data.timestamp).toLocaleString()}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'dbStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'dbStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        async function testTables() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/tables-status`);
                const data = await response.json();

                if (data.success) {
                    const tableCount = Object.keys(data.tables).length;
                    const totalRecords = Object.values(data.tables).reduce((sum, table) => sum + table.count, 0);

                    testResults.passed++;
                    updateStatus(
                        'tablesStatus',
                        `Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (${tableCount} Ø¬Ø¯ÙˆÙ„ØŒ ${totalRecords} Ø³Ø¬Ù„)`,
                        'success',
                        'âœ…',
                        `Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: ${tableCount}\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${totalRecords}\n${Object.entries(data.tables).map(([name, info]) => `${name}: ${info.count} Ø³Ø¬Ù„`).join('\n')}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'tablesStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'tablesStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        async function testClinics() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/clinics`);
                const data = await response.json();

                if (data.success && data.clinics && data.clinics.length > 0) {
                    const activeClinics = data.clinics.filter(c => c.is_active).length;
                    const specialtiesCount = new Set(data.clinics.map(c => c.specialty_name)).size;

                    testResults.passed++;
                    updateStatus(
                        'clinicsStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.clinics.length} Ø¹ÙŠØ§Ø¯Ø© (${activeClinics} Ù†Ø´Ø·Ø©ØŒ ${specialtiesCount} ØªØ®ØµØµ)`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ${data.clinics.length}\nØ¹ÙŠØ§Ø¯Ø§Øª Ù†Ø´Ø·Ø©: ${activeClinics}\nØªØ®ØµØµØ§Øª Ù…Ø®ØªÙ„ÙØ©: ${specialtiesCount}`
                    );
                } else if (data.success) {
                    testResults.warnings++;
                    updateStatus(
                        'clinicsStatus',
                        'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠØ§Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø©',
                        'warning',
                        'âš ï¸'
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'clinicsStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'clinicsStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ®ØµØµØ§Øª
        async function testSpecialties() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/specialties`);
                const data = await response.json();

                if (data.success && data.specialties && data.specialties.length > 0) {
                    testResults.passed++;
                    updateStatus(
                        'specialtiesStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.specialties.length} ØªØ®ØµØµ Ø·Ø¨ÙŠØ©`,
                        'success',
                        'âœ…',
                        `Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª: ${data.specialties.length}\n${data.specialties.map(s => `${s.icon} ${s.name_ar}`).join('\n')}`
                    );
                } else if (data.success) {
                    testResults.warnings++;
                    updateStatus(
                        'specialtiesStatus',
                        'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµØµØ§Øª Ù…Ø³Ø¬Ù„Ø©',
                        'warning',
                        'âš ï¸'
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'specialtiesStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ®ØµØµØ§Øª: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'specialtiesStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ®ØµØµØ§Øª: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        async function testFeedbacks() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/feedbacks`);
                const data = await response.json();

                if (data.success) {
                    const pendingCount = data.feedbacks.filter(f => f.status === 'pending').length;
                    const appliedCount = data.feedbacks.filter(f => f.status === 'applied').length;

                    testResults.passed++;
                    updateStatus(
                        'feedbacksStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.feedbacks.length} Ù…Ù„Ø§Ø­Ø¸Ø© (${pendingCount} Ù…Ø¹Ù„Ù‚Ø©ØŒ ${appliedCount} Ù…Ø·Ø¨Ù‚Ø©)`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${data.feedbacks.length}\nÙ…Ø¹Ù„Ù‚Ø©: ${pendingCount}\nÙ…Ø·Ø¨Ù‚Ø©: ${appliedCount}\nÙ…Ø±ÙÙˆØ¶Ø©: ${data.feedbacks.filter(f => f.status === 'rejected').length}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'feedbacksStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'feedbacksStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function testUsers() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/admins`);
                const data = await response.json();

                if (data.success) {
                    const activeUsers = data.admins.filter(u => u.is_active).length;
                    const superAdmins = data.admins.filter(u => u.role === 'super_admin').length;

                    testResults.passed++;
                    updateStatus(
                        'usersStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.admins.length} Ù…Ø³ØªØ®Ø¯Ù… (${activeUsers} Ù†Ø´Ø·ØŒ ${superAdmins} Ù…Ø´Ø±Ù)`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${data.admins.length}\nÙ…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†: ${activeUsers}\nÙ…Ø´Ø±ÙÙŠÙ†: ${superAdmins}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'usersStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'usersStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        async function testNotifications() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/notifications`);
                const data = await response.json();

                if (data.success) {
                    const unreadCount = data.notifications.filter(n => !n.is_read).length;

                    testResults.passed++;
                    updateStatus(
                        'notificationsStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.notifications.length} Ø¥Ø´Ø¹Ø§Ø± (${unreadCount} ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡)`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${data.notifications.length}\nØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©: ${unreadCount}\nÙ…Ù‚Ø±ÙˆØ¡Ø©: ${data.notifications.filter(n => n.is_read).length}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'notificationsStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'notificationsStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        async function testNews() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/news`);
                const data = await response.json();

                if (data.success) {
                    const activeNews = data.news.filter(n => n.is_active).length;

                    testResults.passed++;
                    updateStatus(
                        'newsStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.news.length} Ø®Ø¨Ø± (${activeNews} Ù†Ø´Ø·)`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: ${data.news.length}\nÙ†Ø´Ø·Ø©: ${activeNews}\nØºÙŠØ± Ù†Ø´Ø·Ø©: ${data.news.filter(n => !n.is_active).length}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'newsStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'newsStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        async function testSyncLogs() {
            testResults.total++;
            try {
                const response = await fetch(`${API_URL}/sync-logs`);
                const data = await response.json();

                if (data.success) {
                    const lastSync = data.logs.length > 0 ? new Date(data.logs[0].sync_timestamp).toLocaleString() : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';

                    testResults.passed++;
                    updateStatus(
                        'syncStatus',
                        `ØªÙ… Ø¬Ù„Ø¨ ${data.logs.length} Ø³Ø¬Ù„ Ù…Ø²Ø§Ù…Ù†Ø© (Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: ${lastSync})`,
                        'success',
                        'âœ…',
                        `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${data.logs.length}\nØ¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: ${lastSync}\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª: ${data.logs.reduce((sum, log) => sum + log.records_updated, 0)}`
                    );
                } else {
                    testResults.failed++;
                    updateStatus(
                        'syncStatus',
                        `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${data.error}`,
                        'error',
                        'âŒ'
                    );
                }
            } catch (error) {
                testResults.failed++;
                updateStatus(
                    'syncStatus',
                    `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${error.message}`,
                    'error',
                    'âŒ'
                );
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        async function runAllTests() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            testResults = {
                total: 0,
                passed: 0,
                failed: 0,
                warnings: 0
            };

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            document.getElementById('progressBar').style.width = '0%';

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª
            document.querySelectorAll('.status').forEach(el => {
                el.innerHTML = '<span class="loading"></span><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>';
                el.className = 'status info';
            });

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            document.querySelectorAll('.details').forEach(el => {
                el.classList.remove('show');
            });

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ
            document.getElementById('summary').classList.remove('show');

            // ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
            await testHealth();
            await testDatabase();
            await testTables();
            await testClinics();
            await testSpecialties();
            await testFeedbacks();
            await testUsers();
            await testNotifications();
            await testNews();
            await testSyncLogs();

            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            updateProgress();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
